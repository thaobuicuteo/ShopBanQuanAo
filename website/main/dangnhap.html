<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="dangnhap.css">
    <link rel="stylesheet" href="sp.css">
    <link rel="stylesheet" href="giohang.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="footer.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body>
    <header class="header">
        <div class="logo">
            <a href="index.html"><img src="logo.jpg" alt="Logo"></a>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Nhập từ khóa tìm kiếm..." id="searchInput">
            <button onclick="searchProducts()">Tìm kiếm</button>
            <div class="search-keywords">
                Từ khóa:
                <a href="#" onclick="filterProducts('Chân váy')">Chân váy</a>
                <a href="#" onclick="filterProducts('Áo')">Áo</a>
                <a href="#" onclick="filterProducts('Set')">Set</a>
                <a href="#" onclick="filterProducts('Đầm')">Đầm</a>
            </div>
        </div>
        <div class="user-actions">
            <a href="dangnhap.html"><img src="icon3.jpg" alt=""> Tài khoản</a>
            <a href="#" class="cart-toggle" onclick="toggleCart()"><img src="icon2.png" alt=""> Giỏ hàng</a>
        </div>
    </header>

    <div class="cart-overlay" id="cartOverlay">
        <div class="cart-header">
            <h2>GIỎ HÀNG</h2>
            <button onclick="toggleCart()">×</button>
        </div>
        <div class="cart-content" id="cartContent"></div>
        <div class="cart-footer">
            <p>Tổng thanh toán: <span id="sum">0</span></p>
            <button><a href="thanhtoan.html">MUA NGAY</a></button>
        </div>
    </div>

    <menu>
        <div class="navbar">
            <a href="index.html">TRANG CHỦ</a>
            <a href="gioithieu.html">Giới thiệu</a>
            <div class="dropdown">
                <a href="#">Danh mục</a>
                <div class="dropdown-content-1">
                    <a href="category.html?category=vay-ngan">Váy ngắn</a>
                    <a href="category.html?category=vay-dai">Váy dài</a>
                    <a href="category.html?category=ao">Áo</a>
                    <a href="category.html?category=chan-vay">Chân váy</a>
                    <a href="category.html?category=set-bo">Set bộ</a>
                </div>
            </div>
            <a href="spgiamgia.html" class="sale">UP TO 50%</a>
            <div class="dropdown">
                <a href="#">Bộ sưu tập</a>
                <div class="dropdown-content">
                    <!-- Bộ sưu tập sẽ được thêm động bởi JavaScript -->
                </div>
            </div>
            <a href="tintuc.html">Tin tức</a>
            <a href="lienhe.html">Liên hệ</a>
        </div>
    </menu>

    <div class="login-container">
        <h2>Đăng nhập</h2>
        <div>
            <input type="text" id="username" placeholder="Tên đăng nhập" required>
            <input type="password" id="password" placeholder="Mật khẩu" required>
            <button onclick="handleLogin()">Đăng nhập</button>
            <a href="dangky.html">Bạn chưa có tài khoản?</a>
            <a href="index.html" class="back-link">Quay lại trang chính</a>
            <p id="error-message" style="color: red; display: none;"></p>
        </div>
    </div>

    <div class="footer">
        <div class="footer-column">
            <h4>Thông tin liên hệ</h4>
            <p>Địa chỉ: Thành phố Hà Nội</p>
            <p>Số điện thoại: 0987654321</p>
            <p>Email: cot@gmail.com</p>
            <p>&copy; 2025 COT. All rights reserved.</p>
        </div>
        <div class="footer-column">
            <h4>Chính Sách</h4>
            <p><a href="#">Chính sách vận chuyển</a></p>
            <p><a href="#">Chính sách đổi trả hàng</a></p>
            <p><a href="#">Chính sách bảo mật thông tin</a></p>
            <p><a href="#">Chính sách kiểm hàng</a></p>
        </div>
        <div class="footer-column">
            <h4>Hỗ Trợ Khách Hàng</h4>
            <p><a href="#">Giới thiệu</a></p>
            <p><a href="#">Quy định chung</a></p>
            <p><a href="#">Hệ thống cửa hàng</a></p>
            <p><a href="#">Kiểm Tra Đơn Hàng</a></p>
        </div>
        <div>
            <div class="social-icons">
                <a href="#"><img src="icfooter1.webp" alt="Facebook"></a>
                <a href="#"><img src="icfooter2.webp" alt="Zalo"></a>
                <a href="#"><img src="icfooter3.webp" alt="TikTok"></a>
            </div>
            <div class="contact-icons">
                <a href="#"><img src="iclienhe1.svg" alt="Zalo Chat"></a>
                <a href="#"><img src="iclienhe2.svg" alt="Phone"></a>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <p class="footer-logo">COT</p>
        <p>Thương hiệu thời trang hàng đầu Việt Nam, mang đến phong cách hiện đại và thanh lịch cho phái đẹp.</p>
    </div>

    <script>
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('error-message');

            if (!username || !password) {
                errorMessage.textContent = 'Vui lòng nhập đầy đủ tên đăng nhập và mật khẩu.';
                errorMessage.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/auth/user-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password }),
                });

                console.log('Response status:', response.status); // Log trạng thái
                const data = await response.json();
                console.log('Response data:', data); // Log dữ liệu

                if (response.ok) {
                    localStorage.setItem('username', data.username); // Lưu tên người dùng
                    if (data.token) localStorage.setItem('token', data.token); // Lưu token nếu có
                    localStorage.setItem("user_id", data.user_id);
                    alert('Đăng nhập thành công!');
                    window.location.href = data.redirectUrl || 'index.html'; // Sử dụng redirectUrl nếu có
                } else {
                    errorMessage.textContent = data.message || 'Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin.';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = `Có lỗi xảy ra: ${error.message}. Vui lòng thử lại sau.`;
                errorMessage.style.display = 'block';
                console.error('Fetch error:', error);
            }
        }
    </script>
    <script src="giohang.js"></script>
    <script src="search.js"></script>
    <script src="main.js"></script>
</body>

</html>